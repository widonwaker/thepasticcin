<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>  
	<title>I Pasticcini</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
	// DA RIMUOVERE
	//localStorage.setItem("deflang","ita");
	</script>
</head>
<body>
<div id="game">

<img class="fabbrica" src="img/edifici/fabbrica5.png" onClick="FactoryUpgrade()"/>
<img class="alloggi" src="img/edifici/alloggi5.png" onClick=""/>
<!--<img class="trasporti" src="img/edifici/trasporto5.png" onClick=""/>-->

<div class="moneybar">
   <img class="top-left-bar" src="img/money_base.png" />
   <img class="top-left-bar" src="img/money_inside.png" />
   <img class="empty" src="img/empty.png" />
   <div class="moneyscore brown" id="score">0</div>
</div>

</div>

<div id="factory-upgrade" class="panel" style="display:none;">
    <img id="alloggi-rib" class="ribbon" />
    <img class="panel-close" src="img/panel/decline.png" onClick='$("#factory-upgrade").hide();' />
    <div class="container">
       <div class="title brown-soft">Bramiti</div>
       <div class="desc">5% more bramiti</div>
       <img class="skills" src="img/panel/skills_0.png" />
       <div class="btn-buy button green-soft">
           <div class="btn-cost centered" onclick="">15</div>
       </div>
    </div>
    <div class="container">
       <div class="title brown-soft">Muggiti</div>
       <div class="desc">2% meno muggiti</div>
       <img class="skills" src="img/panel/skills_3.png" />
       <div class="btn-buy button green-soft">
           <div class="btn-cost centered" onclick="">123456</div>
       </div>
    </div>
    <div class="container">
       <div class="title brown-soft">Muggiti</div>
       <div class="desc">25% meno muggiti</div>
       <img class="skills" src="img/panel/skills_3.png" />
       <div class="btn-buy button green-soft">
           <div class="btn-cost centered" onclick="">123987</div>
       </div>
    </div>
    <div class="upgrade button grey">
       <img src="img/panel/btn_locked.png" style="width:60%;"/>
       <div class="btn-upgrade centered" onclick="">Upgrade</div>
    </div>
</div>
<!--<a onclick="canc()">cancella</a>-->
<script>
/*function test() {
	localStorage.setItem("money_save",start);
}
function canc() {
	localStorage.removeItem("money_save");
}*/

var start = (localStorage.getItem("money_save")!==null) ? parseInt(localStorage.getItem("money_save")) : 1;
var speed = 1000;
$(document).ready(function () {
	alert(localStorage.getItem("deflang"));
	if (start < 10) {
    go();
    setInterval(function () {
        go();
    }, speed);
	}
});
function go() {
	if (start>9) $('.moneyscore').css("right", "1%");
	if (start>99) $('.moneyscore').css("right", "-1%");
	if (start>999) $('.moneyscore').css("right", "-4%");
	if (start>9999) $('.moneyscore').css("right", "-7%");
	if (start>99999) $('.moneyscore').css("right", "-10%");
	if (start>999999) $('.moneyscore').css("right", "-13%");
	if (start>9999999) $('.moneyscore').css("right", "-16%");
	if (start>99999999) $('.moneyscore').css("right", "-19%");
	if (start>999999999) $('.moneyscore').css("right", "-25%");
    $("#score").html(start.toLocaleString());
    start += 1;
}
</script>

<script>
document.addEventListener("deviceready", onDeviceReady, false);
function onDeviceReady() {
	document.addEventListener("pause", onPause, false);	
	flexFont();
}

function onPause() {
	localStorage.setItem("money_save",start);
}
document.onunload = function () {
	localStorage.setItem("money_save",start);
}
</script>

<script>
var src = 'js/' + localStorage.getItem("deflang") + '.js';
var script = jQuery('<script/>').attr('src', src).appendTo('head');
</script>

<script>
function fontSize () {
    var divs = document.getElementsByClassName("moneybar");
    for(var i = 0; i < divs.length; i++) {
        var relFontsize = divs[i].offsetWidth*0.09;
        divs[i].style.fontSize = relFontsize+'px';
	}
		
	var divs = document.getElementsByClassName("title");
    for(var i = 0; i < divs.length; i++) {
        var relFontsize = divs[i].offsetHeight*1.00;
        divs[i].style.fontSize = relFontsize+'px';	
    }
	
	var divs = document.getElementsByClassName("desc");
    for(var i = 0; i < divs.length; i++) {
        var relFontsize = divs[i].offsetHeight*0.90;
        //divs[i].style.fontSize = relFontsize+'px';	
    }
	
	var divs = document.getElementsByClassName("btn-buy");
    for(var i = 0; i < divs.length; i++) {
        var relFontsize = divs[i].offsetWidth*0.15;
        divs[i].style.fontSize = relFontsize+'px';	
    }
	
	var divs = document.getElementsByClassName("btn-upgrade");
    for(var i = 0; i < divs.length; i++) {
        var relFontsize = divs[i].offsetWidth*0.08;
        divs[i].style.fontSize = relFontsize+'px';	
    }
};

window.onload = function(event) {
    fontSize();
};
window.onresize = function(event) {
    fontSize();
};

function FactoryUpgrade() {
	$("#factory-upgrade").show();
	fontSize();
	alert(localStorage.getItem("deflang"));
	if (localStorage.getItem("deflang") == "eng") {
		
	    $('#alloggi-rib').attr('src', 'img/panel/alloggi_eng.png'); 
		alert('inglese: '+$('#alloggi-rib').attr('src'));
	} else if (localStorage.getItem("deflang") == "ita") {
		$('#alloggi-rib').attr('src', 'img/panel/alloggi_ita.png'); 
		alert('italiano: '+$('#alloggi-rib').attr('src'));
	}
}
</script>
</body>
</html>
