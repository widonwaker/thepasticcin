<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>  
	<title>I Pasticcini</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/jquery.min.js"></script>
    <script src="js/settings.js"></script>
    <script>
	// DA RIMUOVERE
	//localStorage.setItem("deflang","ita");
	</script>
</head>
<body>
<div id="game">

<audio id="bgmusic" src="sound/bgmusic.mp3" loop></audio>
<audio id="levelup" src="sound/Powerup.wav" ></audio>
<audio id="skillup" src="sound/Skillup.wav" ></audio>

<img id="factory" class="fabbrica" onClick="FactoryPanel()"/> <img id="factorylevelup" src="img/levelup.png" style="display:none;"/>
<img class="alloggi" src="img/edifici/alloggi1.png" onClick=""/>
<!--<img class="trasporti" src="img/edifici/trasporto5.png" onClick=""/>-->

<div class="moneybar">
   <img class="top-left-bar" src="img/gold_base.png" />
   <img class="top-left-bar" src="img/gold_inside.png" />
   <img class="empty" src="img/empty.png" />
   <div class="moneyscore brown" id="score">0</div>
</div>

<div class="gemsbar">
   <img class="top-right-bar" src="img/gem_base.png" />
   <img class="top-right-bar" src="img/gem_inside.png" />
   <img class="empty" src="img/empty.png" />
   <div class="gems brown" id="gems">0</div>
</div>

<div id="right-screen" style="position:fixed; display:block; top: 10%; right: 1%;">
   <!-- append here -->
</div>

</div>

<div id="factory-panel" class="panel" style="display:none;">
    <img id="factory-rib" class="ribbon" />
    <img class="panel-close" src="img/panel/decline.png" onClick="$('#factory-panel').fadeOut();" />
    <div id="power" class="container">
       <img class="icon" src="img/power.png"/>
       <div class="title brown"></div>
       <div class="desc"></div>
       <img class="skills" />
       <div class="btn-buy button green-soft">
           <div class="btn-cost centered" onclick="SingleUpgrade(this, 'energy')"></div>
       </div>
    </div>
    <div id="machinery" class="container">
       <div class="title brown"></div>
       <div class="desc"></div>
       <img class="skills" />
       <div class="btn-buy button green-soft">
           <div class="btn-cost centered" onclick="SingleUpgrade(this, 'machinery')"></div>
       </div>
    </div>
    <div class="container">
       <div class="title brown">ND</div>
       <div class="desc">NaN</div>
       <img class="skills" src="img/panel/skills_5.png" />
       <div class="btn-buy button green-soft">
           <div class="btn-cost centered" onclick="">0</div>
       </div>
    </div>
    <div class="upgrade button grey">
       <img src="img/panel/btn_locked.png" style="width:60%;"/>
       <div class="btn-upgrade centered" onclick="BuildingNext(this)"></div>
    </div>
</div>


<div id="alloggi-upgrade" class="panel" style="display:none;">
    <img id="alloggi-rib" class="ribbon" />
    <img class="panel-close" src="img/panel/decline.png" onClick='$("#alloggi-upgrade").hide();' />
    <div class="container">
       <div class="title brown-soft">Bramiti</div>
       <div class="desc">+25% more bramits </div>
       <img class="skills" src="img/panel/skills_5.png" />
       <div class="btn-buy button green-soft">
           <div class="btn-cost centered" onclick="">15</div>
       </div>
    </div>
    <div class="container">
       <div class="title brown-soft">Muggiti</div>
       <div class="desc">+240% mura rinforzate</div>
       <img class="skills" src="img/panel/skills_4.png" />
       <div class="btn-buy button green-soft">
           <div class="btn-cost centered" onclick="">123456</div>
       </div>
    </div>
    <div class="container">
       <div class="title brown-soft">Muggiti</div>
       <div class="desc">+10%</div>
       <img class="skills" src="img/panel/skills_5.png" />
       <div class="btn-buy button green-soft">
           <div class="btn-cost centered" onclick="">123987</div>
       </div>
    </div>
    <div class="upgrade button grey">
       <img src="img/panel/btn_locked.png" style="width:60%;"/>
       <div class="btn-upgrade centered" onclick="AlloggiNext()">Upgrade</div>
    </div>
</div>

<div id="askreward" class="option_info none">
   <span class="brown"></span>
   <img class="decline" src="img/panel/decline.png" onClick="Appodeal.show(Appodeal.BANNER_TOP); " />
   <img class="accept" src="img/panel/accept.png" onClick="startReward()" />
</div>

<a onclick="canc()" style="position:fixed; left: 50%; top: 50%;">cancella</a>
<script>
function canc() {
	localStorage.clear();
}

var factorydivs = document.getElementById("factory-panel").getElementsByClassName("btn-cost");

var energy = parseInt(localStorage.getItem("energy")) / 100;
var machinery = parseInt(localStorage.getItem("machinery")) / 100;

var start = parseInt(localStorage.getItem("money_save"));
var speed = (parseInt(localStorage.getItem("fabbrica"))-parseInt(localStorage.getItem("orsettini")) )*(1-energy)*(1-machinery)*(1);

$(document).ready(function () {
	
	document.getElementById("factory").src = localStorage.getItem("factory");
	checkBgmusic();
	  go();
      timer = setInterval(function(p) {
          go(p);
          }, speed, speed);
      });
	  
    setInterval(function () {
        for(var i = 0; i < factorydivs.length; i++) {
	        CheckSingleUpgrade(factorydivs[i]);
	    }
    }, 2000);	  
	
	setInterval(function () {
		if ($('#gemsreward').length === 0) {
		    $('#right-screen').append('<img src="img/play.png" id="gemsreward" class="right-icon" onClick="videoReward(this)" />');
		}
	}, 6000);
	  
function go(p) {
	if(p && p != speed) {
        clearInterval(timer);
        timer = setInterval(function(p) {
           go(p);
        }, speed, speed);
    }
	
	if (start>9) $('.moneyscore').css("right", "1%");
	if (start>99) $('.moneyscore').css("right", "-1%");
	if (start>999) $('.moneyscore').css("right", "-4%");
	if (start>9999) $('.moneyscore').css("right", "-7%");
	if (start>99999) $('.moneyscore').css("right", "-10%");
	if (start>999999) $('.moneyscore').css("right", "-13%");
	if (start>9999999) $('.moneyscore').css("right", "-16%");
	if (start>99999999) $('.moneyscore').css("right", "-19%");
	if (start>999999999) start = 999999999;
    $("#score").html(start.toLocaleString());
    start += parseInt(localStorage.getItem("pasticcino"));
}
</script>

<script>
document.addEventListener("deviceready", onDeviceReady, false);
function onDeviceReady() {
	document.addEventListener("pause", onPause, false);	
	flexFont();
}

function onPause() {
	localStorage.setItem("money_save",start);
}
window.onunload = function () {
	localStorage.setItem("money_save",start);
}
</script>

<script>
var src = 'js/' + localStorage.getItem("deflang") + '.js';
var script = jQuery('<script/>').attr('src', src).appendTo('head');
</script>

<script>
function fontSize () {
    var divs = document.getElementsByClassName("moneybar");
    for(var i = 0; i < divs.length; i++) {
        var relFontsize = divs[i].offsetWidth*0.09;
        divs[i].style.fontSize = relFontsize+'px';
	}
	
	var divs = document.getElementsByClassName("gemsbar");
    for(var i = 0; i < divs.length; i++) {
        var relFontsize = divs[i].offsetWidth*0.12;
        divs[i].style.fontSize = relFontsize+'px';
	}
		
	var divs = document.getElementsByClassName("title");
    for(var i = 0; i < divs.length; i++) {
        var relFontsize = divs[i].offsetHeight*0.93;
        divs[i].style.fontSize = relFontsize+'px';	
    }
	
	var divs = document.getElementsByClassName("desc");
    for(var i = 0; i < divs.length; i++) {
        var relFontsize = divs[i].offsetHeight*0.90;
        //divs[i].style.fontSize = relFontsize+'px';	
    }
	
	var divs = document.getElementsByClassName("btn-buy");
    for(var i = 0; i < divs.length; i++) {
        var relFontsize = divs[i].offsetWidth*0.15;
        divs[i].style.fontSize = relFontsize+'px';	
    }
	
	var divs = document.getElementsByClassName("btn-upgrade");
    for(var i = 0; i < divs.length; i++) {
        var relFontsize = divs[i].offsetWidth*0.08;
        divs[i].style.fontSize = relFontsize+'px';	
    }
};

window.onload = function(event) {
    fontSize();
};
window.onresize = function(event) {
    fontSize();
};
</script>
<script src="js/functions.js"></script>
</body>
</html>
